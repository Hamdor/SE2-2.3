\documentclass[oneside,a4paper,titlepage]{scrartcl} % Format fuer Titelseite und Dokument (Koma-Script)
\usepackage[ngerman]{babel}                         % Sprache
\usepackage[utf8]{inputenc}                         % Direkte Eingabe von Umlauten Dokument
\usepackage[T1]{fontenc}                            % Silbentrennung auch bei Woertern mit Umlauten
\usepackage{graphicx}                               % Bilder
\usepackage{listings}                               % Aufzaehlungen
\usepackage{xcolor}                                 % Farbgebung des Sourcodes
\usepackage{lmodern}                                % Formatierung des Sourcecodes
\usepackage{longtable}                              % Fuer mehrseitige Tabellen
\usepackage{booktabs}                               % Fuer mehrseitige Tabellen
\usepackage{colortbl}                               % Fuer farbige Zeilen/Reihen in Tabellen

% Formatierung fuer Sourcecode
\DeclareFontShape{OT1}{cmtt}{bx}{n}{<5><6><7><8><9><10><10.95><12><14.4><17.28><20.74><24.88>cmttb10}{}
\definecolor{eclipse-violet}{rgb}{0.50,0.0,0.46}
\definecolor{eclipse-green}{rgb}{0.25,0.50,0.37}
\definecolor{eclipse-blue}{rgb}{0.17,0.0,1.00}
\lstset{
 language=C++, % Fuer C++ Coding-Style
 showstringspaces=false,
 basicstyle=\ttfamily\small,
 keywordstyle=\bfseries\color{eclipse-violet},
 commentstyle=\color{eclipse-green},
 stringstyle=\color{eclipse-blue}
}

% Formatierung fuer Tabellen
\usepackage{tabularx}
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}} % L fuer linksbuendig mit Breitenangabe
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}   % C fuer zentriert mit Breitenangabe
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}p{#1}}  % R fuer rechtsbuendig mit Breitenangabe

% Fuer den automatischen Umbruch an einem Bindestrich, wie z.B. bei "Werkstueck-Sortieranlage", statt - die Zeichen "= verwenden

% Beginn des Dokuments
\begin{document}

% Titelseite aufbauen
\titlehead{\flushright\includegraphics[scale=.75]{imgs/HAW_logo.png}}
\subject{Software Engineering II\\Wintersemester 2014/2015}
\title{Requirements and Design Documentation}
\subtitle{Praktikums-Gruppe: 2.3}

% Titelseite: Autoren aufbauen
\author{
\begin{small}
 \begin{tabular}{|l|l|c|L{6cm}|}
  \hline
  \rowcolor{lightgray}\textbf{Name} & \textbf{Vorname} & \textbf{Matrikel-Nr.} & \textbf{E-Mail}\\
  \hline
  \rowcolor{white}Kirstein & Katja & 2125137 & katja.kirstein@haw-hamburg.de\\
  \hline
  Kowalka & Anne-Lena & 2081899 & anne-lena.kowalka@haw-hamburg.de\\
  \hline
  Triebe & Marian & 2124897 & marian.triebe@haw-hamburg.de\\
  \hline
  Winter & Eugen & 2081992 & eugen.winter@haw-hamburg.de\\
  \hline
 \end{tabular}
\end{small}
}

% Titelseite mit Datum und Version erstellen
\date{\today\thanks{Dokument-Version: 0.92}} % ! Hier die Versionsnummer an Versionshistorie anpassen !
\maketitle

% Versionsverlauf aufbauen
\thispagestyle{empty}
% Ueberschrift
\begin{center}
  \Large{\textbf{\underline{Versionsverlauf}}}
\end{center}

% Tabelle
\begin{small}
 \begin{tabular}{|c|c|c|L{6cm}|}
  \hline
  \rowcolor{lightgray}\textbf{Version} & \textbf{Autor} & \textbf{Datum} & \textbf{Anmerkungen}\\
  \hline
  0.1 & Thomas Lehmann & 17.09.2014 & Überarbeitung des Templates\\
  \hline
  0.2 & Anne-Lena Kowalka & 07.10.2014 & Use Cases samt Diagramm, Requirements und Arbeitspakete hinzugefügt\\
  \hline
  0.3 & Eugen Winter & 16.10.2014 & Abnahmetests hinzugefügt\\
  \hline
  0.4 & Eugen Winter & 02.11.2014 & RDD als \LaTeX -Dokument erstellt\\
  \hline
  0.5 & Anne-Lena Kowalka & 05.11.2014 & Diverse Updates, Softwarearchitektur konkretisiert in Komponenten"=Diagramm, Testprotokoll hinzugefügt \\
  \hline
  0.6 & Eugen Winter & 11.11.2014 & Umlaute in .tex-Datei geändert und Formatierungen an den Tabellen vorgenommen.\\
  \hline
  0.7 & Eugen Winter & 13.11.2014 & Interrupt Implementierung und Automaten Diagramme hinzugefügt.\\
  \hline
  0.8 & Alle Team-Mitglieder & 27.11.2014 & Implementierungen von Dispatcher, Automaten und Timer hinzugefügt. Unit-/Komponenten-Tests für HAL, IRQ, Dispatcher und Timer hinzugefügt.\\
  \hline
  0.5 & Anne-Lena Kowalka & 05.11.2014 & Diverse Updates, Softwarearchitektur konkretisiert in Komponenten"=Diagramm, Testprotokoll hinzugefügt \\
  \hline
  0.6 & Eugen Winter & 11.11.2014 & Umlaute in .tex-Datei geändert und Formatierungen an den Tabellen vorgenommen.\\
  \hline
  0.7 & Eugen Winter & 13.11.2014 & Interrupt Implementierung und Automaten Diagramme hinzugefügt.\\
  \hline
  0.8 & Alle Team-Mitglieder & 27.11.2014 & Implementierungen von Dispatcher, Automaten und Timer hinzugefügt. Unit-/Komponenten-Tests für HAL, IRQ, Dispatcher und Timer hinzugefügt.\\
  \hline
  0.9 & Eugen Winter & 02.12.2014 & Timer-Werte und Öffnungsdauer der Weiche in den Nicht-funktionalen Anforderungen angepasst und separate Seite für den Versionsverlauf im RDD erstellt.\\
  \hline
   0.91 & Anne-Lena Kowalka & 03.12.2014 & Allgemeine Überarbeitung, Repository-Konzept aktualisiert, Requirements angepasst (Button bei Bohrung nach unten entfernt), System-Test-Szenarien hinzugefügt\\
   \hline
   0.92 & Anne-Lena Kowalka & 10.12.2014 & Update Requirements, Use Case hinzugefügt (UC4), Use Case Diagramm angepasst\\
   \hline
 \end{tabular}
\end{small}

\newpage

% Inhaltsverzeichnis ohne Seitenzahlen anlegen
\pagestyle{empty}
\tableofcontents

\newpage

% Anfang des Inhalts bei Seitenzahl 1 beginnen lassen
\pagestyle{plain}
\setcounter{page}{1}

% 1. Motivation
\section{Motivation}
Es gilt, eine Werkstück"=Sortieranlage zu programmieren. Die Anlage besteht aus zwei
Förderbändern, die durch eine serielle Schnittstelle miteinander verbunden sind und jeweils durch
einen eigenen GEME-Rechner angesteuert werden.
Es gibt drei Werkstücke unterschiedlicher Art (flach, mit Bohrung und Metall, mit Bohrung ohne
Metall). Am Ende von Band 2 sollen nur normal hohe Werkstücke mit Bohrung nach oben
ankommen, wobei sich Werkstücke mit bzw. ohne Metall abwechseln.

% 2. Teamorganisation
\section{Team-Organisation}

% 2.1 Verantwortlichkeiten
\subsection{Verantwortlichkeiten}
Entscheidungen werden gemeinsam im Team gefällt.\newline
Ansprechpartner gesamtes Team: Eugen Winter\newline
Github-Verwaltung: Marian Triebe\newline
Protokollführerin: Anne-Lena Kowalka\newline
RDD-Führerin: Anne-Lena Kowalka\newline
Implementierung: Katja Kirstein, Anne-Lena Kowalka, Marian Triebe, Eugen Winter\newline
Testen: Katja Kirstein, Anne-Lena Kowalka, Marian Triebe, Eugen Winter\newline

% 2.2 Absprachen
\subsection{Absprachen}
\textbf{Termin für Meetings:} Freitags 14:00 (Stand: 26.9.2014)\newline
\textbf{Weitere Termine:} Nach Absprache

\newpage

% 3. Projektplan
\section{Projektplan}

% 3.1 PSP/Zeitplan/Tracking
\subsection{PSP/Zeitplan/Tracking}
\textbf{Verwendetes Vorgangsmodell:} V-Modell\newline
\newline
\textbf{Festgestellte Arbeitspakete mit ihrer zugehörigen Dauer (Stand: 7.10.2014):}\newline
\newline
 \begin{small}
  \begin{tabular}{|p{8cm}|L{5cm}|}
   \hline
   \rowcolor{lightgray}\textbf{Arbeitspaket} & \textbf{Dauer}\\
   \hline
   Requirements feststellen & 5h insgesamt\\
   \hline
   Use Cases feststellen & 5h insgesamt\\
   \hline
   RDD bearbeiten & 2h/Woche\\
   \hline
   Git-Repository-Verwaltung & 1h/Woche\\
   \hline
   Codequalität sicherstellen & 1h/Woche\\
   \hline
   Schnittstellenansteuerung/Interface & 3h insgesamt\\
   \hline
   Projektplanung mit GanttProject/MS Project & 3h insgesamt\\
   \hline
   Regressions-Tests & 8h insgesamt\\
   \hline
   Protokollführung & 1h/Woche\\
   \hline
   Meetings abhalten & 1.5h/Woche\\
   \hline
   Moderation der Meetings/Agenda erstellen & 30 Min/Meeting bzw. Woche\\
   \hline
   UML-Diagramme erstellen & 8h insgesamt\\
   \hline
   HAL bzw. Ports ansteuern (Tasten, Lichter, serielle Schnittstelle, Sensorik) & 20h insgesamt\\
   \hline
   Tests & 16h insgesamt\\
   \hline
   Fehlerbehandlung/-korrektur & 30h insgesamt\\
   \hline
  \end{tabular}
\end{small}

% 3.2 Repository-Konzept
\subsection{Repository-Konzept}
Coding Style: Google C++ Style Guide, konkrete Beschreibung im Anhang\newline
Branching Strategie: Die aktuelle Entwicklung findet auf dem \emph{develop}-Branch statt. Es gibt die Möglichkeit, Feature-Branches auf Basis des \emph{develop}-Branches zu erstellen. Rechtzeitig zu einem Praktikumstermin wird der aktuelle Entwicklungsstand auf den \emph{master}-Branch verschoben.  

% 3.3 Qualitätssicherung
\subsection{Qualitätssicherung}
Durch Testen nach jeder Phase, bzw. Unit-Tests, soll die Qualität sichergestellt werden.

\newpage

% 4. Randbedingungen
\section{Randbedingungen}

% 4.1 Entwicklungsumgebung
\subsection{Entwicklungsumgebung}
Momentics IDE für QNX, Doxygen, Visual Paradigm

% 4.2 Werkzeuge
\subsection{Werkzeuge}
\textbf{Betriebssystem:} QNX und QNX-VM mit SEAP Simulation\newline
\textbf{Hardware:} GEME Embedded Controller

% 4.3 Sprachen
\subsection{Programmier-Sprachen}
C++ (nur STL)

% 5. Requirements und Use Cases
\section{Requirements und Use Cases}

% 5.1 Stakeholder
\subsection{Stakeholder}
\begin{itemize}
    \item Entwickler
    \item Tester
    \item Kunde
    \item Betreuer
    \item Personal
\end{itemize}

\newpage

% 5.2 Anforderungen
\subsection{Anforderungen}

% 5.2.1 Funktionale Anforderungen
\subsubsection{Funktionale Anforderungen}
\begin{small}
 \begin{longtable}{|C{2cm}|L{4cm}|C{1.5cm}|L{5.5cm}|}
  \hline
  \textbf{ID} & \textbf{Titel} & \textbf{Bereich} & \textbf{Beschreibung}\\
  \toprule
  \endhead
  \hline
  FR-001 & Typen von Werkstücken & Werkstück & Es gibt 3 Typen von Werkstücken:Zu flach, mit Bohrung, sowie mit und ohne Metalleinsatz.\\
  \hline
  \rowcolor{lightgray} FR-002 & Anzahl der Sortierbänder & Anlage & Für die Werkstück"=Sortieranlage stehen 2 Sortierbänder zur Verfügung.\\
  \hline
  FR-003.1 & Ziel der Werkstück"=Sortieranlage & Anlage & Am Ende von Band 2 sollen die Werkstücke im Wechsel mit und ohne Metalleinsatz ankommen.\\
  \hline
  FR-003.2 & Ziel der Werkstück"=Sortieranlage & Anlage & Am Ende von Band 2 sollen die einzelnen Werkstücke mit der Bohrung nach oben liegend ankommen.\\
  \hline
  \rowcolor{lightgray} FR-004 & Zuführung eines Werkstücks in die Werkstück"=Sortieranlage & Anlage & Das Werkstück wird vom Personal an den Anfang von Band 1 in den Bereich der Lichtschranke gelegt.\\
  \hline
  FR-005.1 & Entnahme eines Werkstücks aus der Werkstück"=Sortieranlage & Anlage & Nach dem erfolgreichen Durchlaufen der Sortieranlage, wird das Werkstück am Ende von Band 2 vom Personal entnommen.\\
  \hline
  FR-005.2 & Entnahme eines Werkstücks aus der Werkstück"=Sortieranlage & Anlage & Sobald ein Werkstück am Ende von Band 2 entnommen wurde, läuft Band 2 direkt weiter, sofern auf Band 1 noch ein Werkstück auf den Weitertransport auf Band 2 wartet.\\
  \hline
  \rowcolor{lightgray} FR-006.1 & Erkennen und Aussortieren von zu flachen Werkstücken & Sensorik & Zu flache Werkstücke werden auf Band 1 mit Hilfe der Höhenmessung erkannt.\\
  \hline
  \rowcolor{lightgray} FR-006.2 & Erkennen und Aussortieren von zu flachen Werkstücken & Anlage & Nach der Erkennung werden zu flache Werkstücke auf Band 1 mit Hilfe der Weiche aussortiert.\\
  \hline
  FR-007.1 & Erkennen und Ausrichten verkehrt liegender Werkstücke & Sensorik & Mit Hilfe der Höhenmessung erkennt Band 1, ob ein Werkstück mit der Bohrung nach oben oder unten auf das Band gelegt wurde.\\
  \hline
  FR-007.2 & Erkennen und Ausrichten verkehrt liegender Werkstücke & Anlage & Das verkehrt liegende Werkstück mit der Bohrung nach unten wird an das Ende von Band 1 befördert und Band 1 hält an.\\
  \hline
  FR-007.3 & Erkennen und Ausrichten verkehrt liegender Werkstücke & Anzeige & Die gelbe Signalleuchte der Ampelanlage von Band 1 signalisiert mit einem Blinken dem Personal, dass ein Wenden des Werkstücks notwendig ist.\\
  \hline
  FR-007.4 & Erkennen und Ausrichten verkehrt liegender Werkstücke & Sensorik & Ein Timer wird beim Eintreten in den wartenden Zustand gestartet und räumt dem Personal zum Wenden des Werkstücks eine vordefinierte Zeitspanne ein.\\
  \hline
  FR-007.5 & Erkennen und Ausrichten verkehrt liegender Werkstücke & Personal & Das Personal wendet das Werkstück von Hand mit der Bohrung nach oben, legt es zurück in die Ausgangslichtschranke von Band 1 und betätigt den Start-Button.\\
  \hline
  FR-007.6 & Erkennen und Ausrichten verkehrt liegender Werkstücke & Personal & Nachdem das Personal das Werkstück gewendet und zurückgelegt hat, betätigt es den Start-Taster, um den Betrieb fortzusetzen.\\
  \hline
  FR-007.7 & Erkennen und Ausrichten verkehrt liegender Werkstücke & Fehler & Es kommt zu einer Fehlermeldung, wenn das Werkstück nicht innerhalb der vordefinierten Zeitspanne zurück auf das Ende von Band 1 gelegt worden ist.\\
  \hline
  \rowcolor{lightgray} FR-008.1 & Erkennen und Aussortieren verkehrt liegender Werkstücke & Sensorik & Mit Hilfe der Höhenmessung erkennt Band 2, ob ein Werkstück mit der Bohrung nach unten auf dem Band liegt.\\
  \hline
  \rowcolor{lightgray} FR-008.2 & Erkennen und Aussortieren verkehrt liegender Werkstücke & Anlage & Nach Erkennung eines verkehrt liegenden Werkstücks auf Band 2, wird dieses mit Hilfe der Weiche aussortiert.\\
  \hline
  FR-009.1 & Einhalten der korrekten Reihenfolge der Werkstücke & Sensorik & Mit Hilfe des Metallsensors auf Band 2 wird erkannt, ob hintereinander zwei gleichartige Werkstücke (mit/ohne Metalleinsatz) befördert worden sind.\\
  \hline
  FR-009.2 & Einhalten der korrekten Reihenfolge der Werkstücke & Anlage & Nach Erkennung der falschen Reihenfolge wird das betroffene Werkstück an den Anfang von Band 2 befördert.\\
  \hline
  FR-009.3 & Einhalten der korrekten Reihenfolge der Werkstücke & Anzeige & Die gelbe Signalleuchte der Ampelanlage von Band 2 signalisiert mit einem Blinken dem Personal, dass ein Entfernen des Werkstücks notwendig ist.\\
  \hline
  FR-009.4 & Einhalten der korrekten Reihenfolge der Werkstücke & Personal & Das Personal entfernt das betroffene Werkstück von Hand\\
  \hline
  \rowcolor{lightgray} FR-010 & Hinzufügen von Werkstücken auf Anfang von Band 1 & Anlage & Es dürfen, sobald der Anfang mit der Lichtschranke von Band 1 frei ist, weitere Werkstücke auf den Anfang von Band 1 gelegt werden.\\
  \hline
  FR-011 & Anzahl der Werkstücke auf Band 1 & Anlage & Es dürfen sich mehrere Werkstücke zeitgleich auf Band 1 befinden.\\
  \hline
  \rowcolor{lightgray} FR-012.1 & Übergabe von Werkstücken von Band 1 an Band 2 & Anlage & Die Werkstücke von Band 1 werden einzeln an Band 2 übergeben, wenn dieses frei ist.\\
  \hline
  \rowcolor{lightgray} FR-012.2 & Übergabe von Werkstücken von Band 1 an Band 2 & Anlage & Es darf sich nur ein Werkstück zeitgleich auf Band 2 befinden.\\
  \hline
  FR-013 & Identifizieren eines Werkstücks & Werkstück & Jedes Werkstück bekommt intern nach der Vermessung auf Band 1 eindeutige Werkstück-Eigenschaften zugewiesen.\\
  \hline
  \rowcolor{lightgray} FR-014 & Zusammensetzung der Werkstück-Eigenschaften & Anlage & Die Werkstück-Eigenschaften beinhalten: ID aus fortlaufender Zahl, Typ des Werkstücks (zu flach, mit Metalleinsatz, ohne Metalleinsatz, Bohrung nach oben, Bohrung nach unten) und den Höhenmesswerten von Band 1 und Band 2.\\
  \hline
  FR-015.1 & Ausgeben der Werkstück-Eigenschaften & Anlage & Wenn ein Werkstück das Ende von Band 1 erreicht hat, werden die ID und der Höhenmesswert von Band 1 auf der Konsole ausgegeben.\\
  \hline
  FR-015.2 & Ausgeben der Werkstück-Eigenschaften & Anlage & Wenn ein Werkstück das Ende von Band 2 erreicht hat, werden die ID, der Typ und die Höhenmesswerte auf den Terminals von Band 1 und Band 2 ausgegeben.\\
  \hline
  \rowcolor{lightgray} FR-016 & Ampelanlage & Anzeige & Die Werkstück"=Sortieranlage besitzt an beiden Bändern jeweils eine Ampelanlage, mit der sich der Betriebszustand des jeweiligen Bandes und der gesamten Anlage abbilden lässt.\\
  \hline
  FR-017 & Grüne Signalleuchte & Anzeige & Die grüne Signalleuchte der jeweiligen Ampelanlage signalisiert den fehlerfreien Betrieb.\\
  \hline
  \rowcolor{lightgray} FR-018.1 & Gelbe Signalleuchte & Anzeige & Die gelbe Signalleuchte von Band 1 signalisiert einen Hinweis an das Personal das Werkstück von Hand mit der Bohrung nach oben zu drehen.\\
  \hline
  \rowcolor{lightgray} FR-018.2 & Gelbe Signalleuchte & Anzeige & Die gelbe Signalleuchte von Band 2 signalisiert einen Hinweis an das Personal das Werkstück vom Anfang (bei falscher Reihenfolge) oder  Ende (bei Beendigung eines Durchlaufs) des Bandes zu entfernen.\\
  \hline
  FR-019.1 & Rote Signalleuchte & Anzeige & Die Anlage besitzt eine rote Signalleuchte um zu signalisieren, dass ein Fehler aufgetreten ist: Rutsche voll; zu lange Laufzeit; zu kurze Laufzeit.\\
  \hline
  FR-019.2 & Rote Signalleuchte & Anzeige & Ein nicht quittierter Fehler lässt die rote Signalleuchte schnell blinken (1Hz).\\
  \hline
  FR-019.3 & Rote Signalleuchte & Anzeige & Die Quittierung eines Fehlers ändert das Blinken der roten Signalleuchte in ein Dauerlicht.\\
  \hline
  FR-019.4 & Rote Signalleuchte & Anzeige & Ein Fehler, der verschwunden ist oder sich von selbst gelöst hat, lässt die rote Signalleuchte langsam blinken (0.5Hz).\\
  \hline
  FR-019.5 & Rote Signalleuchte & Anzeige & Solange keine Fehler aufgetreten sind, ist die rote Signalleuchte erloschen.\\
  \hline
  \rowcolor{lightgray} FR-020 & Ruhezustand & Anlage & Befinden sich keine Werkstücke auf den Bändern, sollen diese angehalten werden.\\
  \hline
  FR-021 & Verschwinden von Werkstücken & Fehler & Bei zu langen Laufzeiten zwischen den Lichtschranken liegt ein Verschwinden des Werkstücks vor. Es wird eine Fehlermeldung ausgegeben und die Anlage stoppt.\\
  \hline
  \rowcolor{lightgray} FR-022 & Hinzufügen von Werkstücken mitten auf dem Band & Fehler & Bei zu kurzen Laufzeiten zwischen den Lichtschranken wurde ein Werkstück mitten auf das Band gelegt. Es wird eine Fehlermeldung ausgegeben und die Anlage stoppt.\\
  \hline
  FR-023 & Rutsche voll & Fehler & Bei zu vielen Werkstücken in der Rutsche für die Aussortierung fehlerhafter Werkstücke wird eine Fehlermeldung ausgegeben und die Anlage gestoppt.\\
  \hline
  \rowcolor{lightgray} FR-024.1 & Ansteuerung der Weiche & Weiche & Die Weiche ist im geschlossenen Zustand stromlos und führt Strom, wenn sie geöffnet ist.\\
  \hline
  \rowcolor{lightgray} FR-024.2 & Ansteuerung der Weiche & Gefahr & Eine dauerhaft geöffnete Weiche muss aufgrund von Überhitzung des Motors vermieden werden!\\
  \hline
  FR-025 & Not-Aus der Anlage & Gefahr & Die Anlage darf erst nach einem Reset und einem erneuten Starten durch den Start-Taster wieder in Betrieb gehen und nicht bereits nach der Behebung des Fehlers!\\
  \hline
  \rowcolor{lightgray} FR-026 & Bandlaufgeschwindigkeit bei Höhenmessung & Sensorik & Bei der Höhenmessung auf Band 1 und Band 2 werden die Werkstücke im langsamen Modus des Bandes befördert.\\
  \hline
  FR-027 & Start-Taster & Taster & Die Anlage besitzt einen Start-Taster samt zugehöriger Leuchte zum Einschalten der Anlage.\\
  \hline
  \rowcolor{lightgray} FR-028 & Stop-Taster & Taster & Die Anlage besitzt einen Stop-Taster samt zugehöriger Leuchte zum Ausschalten der Anlage.\\
  \hline
  FR-029.1 & Reset-Taster & Taster & Die Anlage besitzt einen Reset-Taster samt zugehöriger Leuchte zur Quittierung von Fehlern im Betrieb der Anlage.\\
  \hline
  FR-029.2 & Reset-Taster & Taster & Jeder Fehler muss zuerst quittiert werden. Erst dann kann der Betrieb durch das Betätigen des Ein-Tasters wieder aufgenommen werden.\\
  \hline
  \rowcolor{lightgray} FR-030.1 & E-Stopp-Taster & Taster & Die Anlage besitzt einen E-Stopp-Taster samt zugehöriger Leuchte zur Schnellabschaltung und Stilllegung der gesamten Werkstück"=Sortieranlage.\\
  \hline
  \rowcolor{lightgray} FR-030.2 & E-Stopp-Taster & Taster & Der E-Stopp-Taster ist LOW-aktiv.\\
   \hline
  \rowcolor{lightgray} FR-030.3 & E-Stopp-Taster & Taster & Nach Betätigung des E-Stopp-Tasters muss das Programm neu gestartet werden.\\
  \hline
 \end{longtable}
\end{small}

\newpage

% 5.2.2 Nicht-funktionale Anforderungen
\subsubsection{Nicht-funktionale Anforderungen}
\begin{small}
 \begin{longtable}{|p{2cm}|p{4cm}|p{1.5cm}|p{5.5cm}|}
  \hline
  \textbf{ID} & \textbf{Titel} & \textbf{Bereich} & \textbf{Beschreibung}\\
  \toprule
  \endhead
  \hline
  NFR-001 & Timer für das Wenden eines Werkstücks am Ende von Band 1 & Sensorik & Nachdem erkannt wird, dass ein Werkstück mit der Bohrung nach unten auf Band 1 liegt, wird es in die Lichtschranke am Ende von Band 1 gefahren und es läuft ein Timer für 15 Sekunden. In dieser Zeit muss das Werkstück vom Personal gewendet werden, ansonsten wird eine Fehlermeldung ausgelöst.\\
  \hline
  \rowcolor{lightgray} NFR-002 & Timer für das Entfernen eines Werkstücks in falscher Reihenfolge am Anfang von Band 2 & Sensorik & Nachdem das korrekt sortierte Werkstück in falscher Reihenfolge auf Band 2 erkannt wurde, fährt es in die Lichtschranke am Anfang von Band 2 zurück und es läuft ein Timer für 15 Sekunden. In dieser Zeit muss das Werkstück vom Personal entfernt werden, ansonsten wird eine Fehlermeldung ausgelöst.\\
  \hline
  NFR-003 & Timer für das Entfernen eines korrekt sortierten Werkstücks am Ende von Band 2 & Sensorik & Nachdem das korrekt sortierte Werkstück das Ende der Lichtschranke von Band 2 erreicht hat, läuft ein Timer für 15 Sekunden. In dieser Zeit muss das Werkstück vom Personal entfernt werden, ansonsten wird eine Fehlermeldung ausgelöst.\\
  \hline
  \rowcolor{lightgray} NFR-004.1 & Timer für die Beförderung eines Werkstücks durch die Werkstück"=Sortieranlage & Sensorik & Ein korrektes Werkstück durchläuft die einzelnen Bänder der Werkstück"=Sortieranlage jeweils innerhalb eines Intervalls von 12 Sekunden.\\
  \hline
  \rowcolor{lightgray} NFR-004.2 & Timer für die Beförderung eines Werkstücks durch die Werkstück"=Sortieranlage & Sensorik & Eine Laufzeitmessung durch die Lichtschranken von weniger als 4-5 Sekunden bedeutet, dass ein weiteres Werkstück unter Fremdeinwirkung auf das Band gelegt worden ist. Das Band wird angehalten und es wird eine Fehlermeldung ausgelöst.\\
  \hline
  \rowcolor{lightgray} NFR-004.3 & Timer für die Beförderung eines Werkstücks durch die Werkstück"=Sortieranlage & Sensorik & Eine Laufzeitmessung durch die Lichtschranken von mehr als 4-5 Sekunden bedeutet, dass ein Werkstück unter Fremdeinwirkung vom Band entfernt worden ist. Das Band wird angehalten und es wird eine Fehlermeldung ausgelöst.\\
  \hline
  NFR-005 & Timer für das Hinzufügen neuer Werkstücke auf Band 1 & Sensorik & Nachdem ein Werkstück in die Lichtschranke am Anfang von Band 1 gelegt worden ist und das Band läuft, startet ein Timer für 3 Sekunden. In dieser Zeit darf kein neues Werkstück in die Lichtschranke am Anfang von Band 1 gelegt werden, da sonst ein reibungsloser Betrieb nicht mehr garantiert ist. Ansonsten wird eine Fehlermeldung ausgelöst.\\
  \hline
  \rowcolor{lightgray} NFR-006.1 & Toleranz für die Höhe eines Werkstücks & Sensorik & Die Toleranz für die Höhe eines zu flachen Werkstücks liegt bei 10-15 Millimetern.\\
  \hline
  \rowcolor{lightgray} NFR-006.2 & Toleranz für die Höhe eines Werkstücks & Sensorik & Die Toleranz für die Höhe eines Werkstücks mit Bohrung nach oben liegt bei 20-30 Millimetern.\\
  \hline
  \rowcolor{lightgray} NFR-006.3 & Toleranz für die Höhe eines Werkstücks & Sensorik & Die Toleranz für die Höhe eines Werkstücks mit Bohrung nach unten liegt bei 25-30 Millimetern.\\
  \hline
  NFR-007 & Öffnungsdauer der Weiche & Sensorik & Für das Durchlassen gültiger Werkstücke wird die Weiche geöffnet, nachdem ein gültiges Werkstück den Sensor
  für den Weichen-Bereich durchbrochen hat und wieder geschlossen, sobald das
  gültige Werkstück den Sensor des Weichen-Bereichs wieder verlassen hat.\\
  \hline
 \end{longtable}
\end{small}

\newpage

% 5.3 Use Cases
\subsection{Use Cases}

\subsubsection{UC1}
\begin{tabbing}
 Links \= Mitte \= Rechts \kill
 \textbf{Titel:} \> \> Akzeptiertes Werkstück\\
 \textbf{Akteur:} \> \> Personal\\
 \textbf{Ziel:} \> \> Werkstück kommt am Ende von Band 2 an\\
 \textbf{Auslöser:} \> \> Ein Werkstück wird in die Lichtschranke am Anfang von Band 1 gelegt. B[0]=0\\
\end{tabbing}
\textbf{Vorbedingung:}
\begin{enumerate}
 \item Laufband 1 befindet sich im Betriebszustand
 \item Die Lichtschranke am Anfang von Band 1 ist frei. B[0]=1
\end{enumerate}
\textbf{Nachbedingung:}
\begin{itemize}
    \item Keine
\end{itemize}
\textbf{Erfolgsszenario:}
\begin{enumerate}
 \item Dem Werkstück wird eine ID vergeben
 \item Die Höhe des Werkstückes wird durch den Höhenmesser ermittelt. B[1]=0
 \item Die Höhe des Werkstücks ist im Toleranzbereich. B[1]=1
 \item Die Weiche des ersten Bandes wird geöffnet und das Werkstück durchgelassen. B[2]=0 und B[5]=1
 \item Die Weiche wird geschlossen. B[5]=0
 \item Das Werkstück kommt auf Band 2, wenn dieses frei ist
 \item Der Typ des Werkstücks wird festgelegt. Das Werkstück mit Bohrung nach oben und mit Metalleinsatz, bzw. ohne Metalleinsatz wird im Wechsel akzeptiert.\\
       (Metall-Kunststoff oder Kunststoff-Metall)
 \item Die Weiche wird geöffnet und das Werkstück durchgelassen. B[2]=0 und B[5]=1
 \item Die Weiche wird geschlossen. B[5]=0
 \item Das Werkstück erreicht die Lichtschranke am Ende von Band 2. B[7]=0
 \item Laufband 2 bleibt stehen
 \item Das Werkstück wird vom Personal entfernt. B[7]=1
\end{enumerate}
\newpage
\textbf{Fehlerszenario:}
\begin{enumerate}
 \item Das Werkstück liegt nicht im Toleranzbereich der Höhe und wird aussortiert.
 \item Die Kommunikation zwischen beiden Laufbändern funktioniert nicht.
 \item Die Reihenfolge der Werkstücke ist falsch.
 \item Werkstücke werden mitten im Betrieb hinzugefügt oder weggenommen.
\end{enumerate}

\subsubsection{UC2}
\begin{tabbing}
 Links \= Mitte \= Rechts \kill
 \textbf{Titel:} \> \> Nicht akzeptiertes Werkstück (zu flach)\\
 \textbf{Akteur:} \> \> -\\
 \textbf{Ziel:} \> \> Werkstücke die zu flach sind, werden von Band 1 aussortiert\\
 \textbf{Auslöser:} \> \> Höhenmesser ermittelt die Höhe des Werkstücks. B[2]\\
\end{tabbing}
\textbf{Vorbedingung:}
\begin{enumerate}
 \item Laufband 1 befindet sich im Betriebszustand
 \item Eingelegtes Werkstück ist zu flach
\end{enumerate}
\textbf{Nachbedingung:}
\begin{itemize}
 \item Aussortiertes Werkstück liegt in der Rutsche
\end{itemize}
\textbf{Erfolgsszenario:}
\begin{enumerate}
 \item Die Höhe des Werkstückes wird durch den Höhenmesser ermittelt. B[1]=0
 \item Das Werkstück ist zu flach. B[2]=1
 \item Die Weiche bleibt im geschlossenen Zustand. B[5]=0
 \item Das Werkstück wird aussortiert
\end{enumerate}
\textbf{Fehlerszenario:}
\begin{enumerate}
 \item Rutsche ist voll
 \item Werkstück bleibt in der Lichtschranke hängen
\end{enumerate}

\subsubsection{UC3}
\begin{tabbing}
 Links \= Mitte \= Rechts \kill
 \textbf{Titel:} \> \> Nicht akzeptiertes Werkstück auf Band 1 (Bohrung nach unten)\\
 \textbf{Akteur:} \> \> Personal\\
 \textbf{Ziel:} \> \> Werkstück am Ende von Band 1 wird mit der Bohrung nach oben umgedreht\\
 \textbf{Auslöser:} \> \> Höhenmesser ermittelt die Höhe des Werkstücks. B[2]\\
\end{tabbing}
\textbf{Vorbedingung:}
\begin{enumerate}
 \item Laufband 1 befindet sich im Betriebszustand
 \item Es befindet sich ein Werkstück auf Band 1
\end{enumerate}
\textbf{Nachbedingung:}
\begin{itemize}
 \item Ein Werkstück befindet sich am Laufbandende
\end{itemize}
\textbf{Erfolgsszenario:}
\begin{enumerate}
 \item Die Höhe des Werkstückes wird durch den Höhenmesser ermittelt. B[1]=0
 \item Ein Werkstück mit Bohrung nach unten wird erkannt
 \item Die Weiche wird geöffnet und das Werkstück durchgelassen. B[2]=0 und B[5]=1
 \item Das Werkstück wird am Ende von Band 1 von der Lichtschranke registriert
 \item Das Laufband bleibt stehen und die gelbe Signalleuchte blinkt. A[6]=1
 \item Das Personal dreht das Werkstück per Hand mit der Bohrung nach oben um
 \item Das Personal betätigt den Start-Taster.
\end{enumerate}

\subsubsection{UC4}
\begin{tabbing}
    Links \= Mitte \= Rechts \kill
    \textbf{Titel:} \> \> Falsche Reihenfolge auf Band 2(Metall-Metall oder Nicht-Metall - Nicht-Metall)\\
    \textbf{Akteur:} \> \> Personal\\
    \textbf{Ziel:} \> \> Werkstücke mit Metall und ohne Metall kommen abwechselnd am Ende von Band 2 an\\
    \textbf{Auslöser:} \> \> Metallsensor erfasst zwei Mal denselben Typ. B[2]\\
\end{tabbing}
\textbf{Vorbedingung:}
\begin{enumerate}
    \item Laufband 2 befindet sich im Betriebszustand
    \item Werkstücke in falscher Reihenfolge auf Band 1
\end{enumerate}
\textbf{Nachbedingung:}
\begin{itemize}
    \item Die richtige Reihenfolge der Werkstücke ist wieder hergestellt.
\end{itemize}
\textbf{Erfolgsszenario:}
\begin{enumerate}
 \item Der Werksücktyp wird ermittelt. B[4]
 \item Es wird erkannt, dass zweimal hintereinander derselbe Typ erfasst wurde.
 \item Das Werkstück fährt rückwärts an den Anfang von Band 2.
 \item Das Werkstück wird am Anfang von Band 2 von der Lichtschranke registriert
 \item Das Laufband bleibt stehen und die gelbe Signalleuchte blinkt. A[6]=1
 \item Das Personal entnimmt das Werkstück.
\end{enumerate}

\subsubsection{UC5}
\begin{tabbing}
 Links \= Mitte \= Rechts \kill
 \textbf{Titel:} \> \> Rutsche voll\\
 \textbf{Akteur:} \> \> Personal\\
 \textbf{Ziel:} \> \> Rutsche wieder frei. B[6]=1\\
 \textbf{Auslöser:} \> \> Sensorik erkennt, dass die Rutsche voll ist. B[6]=0\\
\end{tabbing}
\textbf{Vorbedingung:}
\begin{enumerate}
 \item Laufband befindet sich im Betriebszustand
 \item Die Rutsche ist voll
\end{enumerate}
\textbf{Nachbedingung:}
\begin{enumerate}
 \item Die Rutsche ist wieder frei für mindestens ein Werkstück
 \item Das Laufband befindet sich im Betriebszustand. B[6]=1 und A[5]=1
\end{enumerate}
\textbf{Erfolgsszenario:}
\begin{enumerate}
 \item Laufband bleibt stehen. Rote Signalleuchte blinkt schnell (1Hz) $\rightarrow$ anstehend unquittiert. A[7]=1
 \item Das Personal drückt den Reset-Taster $\rightarrow$ LED Resettaste leuchtet nicht mehr. C[1]=0
 \item Rote Signalleuchte leuchtet (Dauerlicht) $\rightarrow$ anstehend quittiert. A[7]=1
 \item Das Personal leert die Rutsche. B[6]=1
 \item Das Personal bestätigt die Leerung der Rutsche durch Drücken des Start-Tasters
 \item Anlage läuft wieder $\rightarrow$ Rote Signalleuchte erlischt, grüne Signalleuchte leuchtet. A[7]=0 und A[5]=1
\end{enumerate}
\textbf{Fehlerszenario:}
\begin{enumerate}
 \item Das Personal leert die Rutsche, aber quittiert den Fehler nicht
 \item Der Start-Taster wird nicht nach Leerung der Rutsche gedrückt
 \item Der Fehler wird quittiert und die Anlage gestartet, ohne dass die Rutsche geleert wurde
\end{enumerate}


\subsubsection{UC6}
\begin{tabbing}
 Links \= Mitte \= Rechts \kill
 \textbf{Titel:} \> \> Verschwinden von Werkstücken\\
 \textbf{Akteur:} \> \> Personal\\
 \textbf{Ziel:} \> \> Das Fehlen des erfassten Werkstückes wird durch die Anlage signalisiert\\
 \textbf{Auslöser:} \> \> Das Programm meldet zu lange Laufzeiten zwischen Lichtschranken\\
\end{tabbing}
\textbf{Vorbedingung:}
\begin{enumerate}
 \item Laufband befindet sich im Betriebszustand
 \item Ein Werkstück wird vom Band entfernt
\end{enumerate}
\textbf{Nachbedingung:}
\begin{itemize}
 \item Laufband läuft wieder (nur die grüne Signalleuchte leuchtet). A[5]=1
\end{itemize}
\textbf{Erfolgsszenario:}
\begin{enumerate}
 \item Laufband bleibt stehen. Rote Signalleuchte blinkt schnell (1 Hz) $\rightarrow$ anstehend unquittiert. A[7]=1
 \item Das Personal drückt den Reset-Taster $\rightarrow$ LED Resettaste leuchtet nicht mehr. C[1]=0
 \item Rote Signalleuchte leuchtet nicht mehr.
 \item Das Personal betätigt den Start-Taster.
 \item Anlage läuft wieder $\rightarrow$ Grüne Signalleuchte leuchtet. A[7]=0 und A[5]=1
\end{enumerate}

\newpage

\subsubsection{UC7}
\begin{tabbing}
 Links \= Mitte \= Rechts \kill
 \textbf{Titel:} \> \> Hinzufügen von Werkstücken mitten auf dem Band\\
 \textbf{Akteur:} \> \> Personal\\
 \textbf{Ziel:} \> \> Das nicht erfasste Werkstück wird entfernt\\
 \textbf{Auslöser:} \> \> Das Programm meldet zu kurze Laufzeiten zwischen Lichtschranken\\
\end{tabbing}
\textbf{Vorbedingung:}
\begin{enumerate}
 \item Laufband befindet sich im Betriebszustand
 \item Ein Werkstück wird mittendrin auf das Band gelegt
\end{enumerate}
\textbf{Nachbedingung:}
\begin{itemize}
 \item Laufband läuft wieder (nur die grüne Signalleuchte leuchtet). A[5]=1
\end{itemize}

\textbf{Erfolgsszenario:}
\begin{enumerate}
 \item Laufband bleibt stehen. Rote Lampe blinkt schnell (1 Hz) $\rightarrow$ anstehend unquittiert. A[7]=1
 \item Personal drückt den Reset-Taster $\rightarrow$ LED Resettaste leuchtet nicht mehr. C[1]=0
 \item Rote Lampe leuchtet (Dauerlicht) $\rightarrow$ anstehend quittiert. A[7]=1
 \item Das Personal entfernt das Werkstück
 \item Das Personal bestätigt das Entfernen des Werkstücks durch Drücken des Start-Tasters
 \item Anlage läuft wieder $\rightarrow$ Rote Signalleuchte erlischt, grüne Signalleuchte leuchtet. A[7]=0 und A[5]=1
\end{enumerate}
\textbf{Fehlerszenario:}
\begin{enumerate}
    \item Personal entfernt das Werkstück nicht
    \item Personal entfernt das falsche Werkstück
\end{enumerate}

\newpage

\subsubsection{UC8}
\begin{tabbing}
 Links \= Mitte \= Rechts \kill
 \textbf{Titel:} \> \> Zurücksetzen des Laufbands\\
 \textbf{Akteur:} \> \> Personal\\
 \textbf{Ziel:} \> \> Laufband in Ursprungszustand versetzen\\
 \textbf{Auslöser:} \> \> Das Personal betätigt den Reset-Taster. C[6]=1\\
\end{tabbing}
\textbf{Vorbedingung:}
\begin{itemize}
 \item Laufband befindet sich im Betriebszustand
\end{itemize}
\textbf{Nachbedingung:}
\begin{itemize}
 \item Auf der Anlage befindet sich kein Werkstück
\end{itemize}
\textbf{Erfolgsszenario:}
\begin{enumerate}
 \item Das Laufband bleibt stehen
 \item Das Personal entnimmt alle Werkstücke von der Anlage
 \item Das Personal betätigt erneut die Reset-Taste. C[6]=0
 \item Laufband ist Betriebsbereit $\rightarrow$ Grüne Signalleuchte leuchtet. A[5]=1
\end{enumerate}

\subsubsection{UC9}
\begin{tabbing}
 Links \= Mitte \= Rechts \kill
 \textbf{Titel:} \> \> Starten der Anlage nach Schnellabschaltung\\
 \textbf{Akteur:} \> \> Personal\\
 \textbf{Ziel:} \> \> Die gesamte Anlage ist wieder Betriebsbereit\\
 \textbf{Auslöser:} \> \> E-Stopp-Taster wird gedrückt. C[7]=0\\
\end{tabbing}
\textbf{Vorbedingung:}
\begin{itemize}
 \item Anlage ist angeschaltet
\end{itemize}
\textbf{Nachbedingung:}
\begin{itemize}
 \item Laufband ist Betriebsbereit. A[5]=1
\end{itemize}
\textbf{Erfolgsszenario:}
\begin{enumerate}
 \item Die ganze Anlage (Band 1 und Band 2) steht still
 \item Alle Ampeln sind aus
 \item Alle Weichen sind geschlossen
 \item Das Personal drückt den Start-Taster
 \item Die Anlage läuft wieder
\end{enumerate}

% 5.4 Use-Case-Diagramm
\begin{figure}
 \subsection{Use-Case-Diagramm}
 \centering\vfill\includegraphics[angle=90,scale=0.7]{imgs/UseCases.png}
\end{figure}

\newpage

% 5.5 Systemanalyse
\subsection{Systemanalyse}
Das System wird über ein C++-Programm gesteuert, welches auf einem bzw. zwei (bei Nutzung von zwei Förderbändern) GEME-Rechnern läuft. Die Aktorik und Sensorik werden über 3 Ports angesteuert, wobei die Sensoren die Werte mittels Interrupts dem System mitteilen.\newline
Die Kommunikation der beiden Förderbänder läuft über eine serielle Schnittstelle. Es werden hier z.B. die Messergebnisse von Band 1 an Band 2 übergeben, damit, wenn ein Puk das Ende von Band 2 erreicht, seine zugehörigen Daten ausgegeben werden können. Nachrichteneingänge über die serielle Schnittstelle werden ebenfalls durch Interrupts realisiert.\newline
\newpage

% 6. Design
\section{Design}

% 6.1 System-Architektur
\subsection{System-Architektur}
Das System verfügt über folgende Module: HAL zum Ansteuern/Auslesen der Aktorik und Sensorik, Seriellen Bus zur Ansteuerung der seriellen Schnittstelle, FSM zur Anlagensteuerun, Dispatcher, der die Pulse Messages entgegennimmt, Timer zur Zeitmessung/-kontrolle und util(mutex, condvar, lockguard, logging, singleton\_mgr, HAWThread, light\_mgr). Des weiteren gibt es zugehörige Unit-Tests.\newpage

\begin{figure}
    \subsubsection{Komponentendiagramm}
    \centering\vfill\includegraphics[angle=0,scale=0.8]{imgs/Sortieranlage-Komponenten.png}
    \newline
\end{figure}

% 6.2 Datenmodell
\subsection{Datenmodell}
siehe Klassendiagramm im imgs-Ordner \newline

% 6.3 Datenmodell
\subsection{Verhaltensmodell}
siehe Automatendiagramme

% 6.3.1 Automat für Band 1
\begin{figure}
	\subsubsection{Automat für Band 1}
	\centering\vfill\includegraphics[angle=90,scale=0.6]{imgs/Band1_FSM.png}
\end{figure}

% 6.3.2 Automat für Band 2
\begin{figure}
	\subsubsection{Automat für Band 2}
	\centering\vfill\includegraphics[angle=0,scale=0.52]{imgs/Band2_FSM.png}
	\subsubsection{Automat für Fehlerbehebung}
	\centering\vfill\includegraphics[angle=0,scale=0.6]{imgs/Error_FSM.png}
\end{figure}

\newpage

% 7. Implementierung
\section{Implementierung}

% 7.1 Patterns
\subsection{Patterns}
Scoped Locking, DCLP, Singelton, Delegator, Factory, Dispatcher- / Reactor-Pattern und GoF-State-Pattern nach Pareigis.

% 7.2 Interrupt Implementierung
\subsection{Interrupt-Implementierung}
Die ISR soll eine Pulse Message generieren. Diese landet im Pulse Message Channel, der vom Dispatcher abgehört wird.
Der Code in der Pulse Message spezifiziert die Quelle des Ereignisses. Als zusätzlicher Integer wird das geänderte Bit angehängt. Dabei wird Port A um 8 Bits nach Links geschoben. Port B wird per Veroderung angehängt. Als Vergleich dienen die Port-Werte vor dem Interrupt. Um nun das geänderte Bit zu erkennen, werden aktueller Wert und alter Wert per Exklusiv-Oder verknüpft.
\newpage

% 7.3 Dispatcher Implementierung
\subsection{Dispatcher-Implementierung}
Die Implementierung des Dispatchers verteilt Events (Eingangsereignisse) an angemeldete Zustände.
Als Quellen für Eingangssignale dienen ISR, Timer, Serielle Schnittstelle. Intern werden die Signale
nur an den ersten Zustand einer Fifo weitergereicht. Für jeden anmeldbaren Zustand gibt es eine eigene Fifo. \newline
Als Fifo Container wurde die std::queue benutzt. Jede Queue geht über Pointer-to-Memberfunctions.
Im System exsistiert ein Pulse-Message-Channel, in den die Eingangssignalquellen Pulse-Messages schreiben.
Der Dispatcher implementiert einen eigenen Thread, der diese Pulse-Messages aus dem Channel liest und die passende Pointer-to-Memberfunktion aufruft.

% 7.4 Automaten Implementierung
\subsection{Automaten-Implementierung}
Die Automaten werden nach dem GoF-State-Pattern nach Pareigis umgesetzt. Die Transition findet durch den
Placement-New Operator statt. Die Kontext-Klasse \emph{token} dient der Abbildung eines Pucks. In ihr werden die
Eigenschaften des Pucks und dessen Zustand gespeichert.\newline
Die Zustände des Pucks werden durch die Klasse \emph{state} repräsentiert. Sie leitet sich von der Klasse
\emph{events} ab, die die Transitionen in Form von \emph{pure virtual} Funktionen vorgibt.\newline
Jeder Subzustand von \emph{state} meldet sich für ein Event beim Dispatcher an und implementiert die Transition
für diesen.\newline
Der Start- und Endzustand eines jeden Tokens ist \emph{anonymous\_token}.\newline
Der Dispatcher führt eine Queue über die Anzahl der maximal auf einem Laufband befindlichen Tokens, die mit dem Zustand
\emph{anonymous\_token} vorinitialisiert werden.

% 7.5 Timer Implementierung
\subsection{Timer Implementierung}
Die QNX eigenen Timer-Funktionen werden in \emph{timer\_wrapper} gewrapped, um von dem \emph{timer\_handler} verwaltet zu werden. Bei diesem \emph{timer\_handler} können Timer mit einer Zeitspanne registriert werden.
Die registrierten Timer können pausiert, fortgesetzt, addiert, subtrahiert und gestoppt werden.\newline
Timer werden eingesetzt:
\begin{itemize}
    \item um zu prüfen, ob Werkstücke hinzugefügt oder entfernt wurden
    \item um zu prüfen, ob die Rutsche voll ist
    \item um die Ampel blinken zu lassen
\end{itemize}

\newpage

 \subsubsection{Diskussion der Hardware und Betriebssystem Timer}
   QNX stellt 3 Arten von Timern zu Verfügung:
   \begin{itemize}
    \item Realtime
    \item Monotonic
    \item Softtime
   \end{itemize}
   Der Realtime-Timer lässt sich durch Zeitänderung ein wenig manipulieren. Der Timer wird aktiv, sobald der Zeitpunkt: Timer-Zeit plus Startzeitpunkt erreicht wurde.
   Wenn z.B. die BS Zeit sich während des Timers synchronisiert und dadurch um einen Augenblick erhöht, so schlägt der Realtime-Timer trotzdem an dem errechneten Zeitpunkt an, auch wenn die Zeit in Wirklichkeit noch nicht verstrichen ist.\newline
   Der Monotonic-Timer hingegen lässt sich nicht von diesen Zeiten beeinflussen. Er zählt seine Takte und wenn diese erreicht wurden, wird er aktiv.\newline
   Ein Softtime-Timer ist nur aktiv, wenn auch die CPU läuft. Dieser Timer kann die CPU nicht wecken und schlägt erst Alarm, wenn er wieder aktiv ist.\newline

% 8. Testen
\section{Testen}

% 8.1 Unit-Test/Komponenten-Test
\subsection{Unit-Test/Komponenten-Test}
Es gibt Testfälle für die einzelnen Komponenten. Für die Unit-Tests steht eine Testumgebung zur Verfügung.
Jeder Unit Test muss das Unit-Test-Interface implementieren, damit diese automatisiert ausgeführt werden
können.

\subsubsection{HAL}
Im Unit Test für die HAL werden 2 verschiedene Stubs verwendet. Die Hardware wird dafür nicht verwendet,
da diese Stubs das Verhalten der Hardware emulieren. Alle Funktionen der HAL werden bei dem Test einmal durchlaufen
und es wird geprüft, ob die Funktionen die erwarteten Rückgabewerte liefern.

\subsubsection{IRQ}
Der automatisierte IRQ/ISR Test öffnet einmal die Weiche. Dabei wird die Lichtschranke der Weiche unterbrochen,
was eine Pulse-Message  generiert. Diese muss im Channel liegen.

\newpage

\subsubsection{Dispatcher}
Für den Dispatcher gibt es verschiedene Unit-Tests. Zum einen wird getestet,
ob das Mapping vom Event-enum zum internen Dispatched-Event-enum passt.
Außerdem wird geprüft, ob in dem Funktionsadressen-Array die korrekten Adressen liegen.
Ein weiterer Test prüft ob, der Dispatcher die Events sequenziell verteilt. Dazu gibt es eine
FSM, die nur aus einem Zustand besteht, jedoch für jede Eingabe eine Transition auf sich selbst hat.
Bei der Transition wird geprüft ob das erhaltene Eingangssignal das erwartete Eingangssignal ist.
Die FSM wird zweimal durchlaufen. Beim ersten Mal wird der Dispatcher-Thread umgangen, indem die Events
direkt aufgerufen werden. Das zweite Mal schreibt Pulse Messages in den Channel, die vom Dispatcher
verteilt werden.

\subsubsection{Timer}
Beim Timer werden die Grundfunktionalitäten getestet.\newline
Zum Testen der Registrierungsfunktion wird ein Timer gestartet und auf die Pulse Message gewartet.\newline
Um die Funktionen add, sub, pause und continue zu testen, wird jedoch ein weiterer Timer registriert.
Dieser zusätzliche Timer sendet eine andere Message beim Ablaufen,wodurch verhindert wird, dass kein Interrupt
geworfen wird.

\newpage

% 8.2 Integrations-Test/System-Test
\subsection{Integrations-Test/System-Test}
\textbf{Beim Systemtest werden folgende Szenarien getestet:}\\
\begin{enumerate}
    \item Es werden zu flache Pucks auf Band 1 gelegt, um zu prüfen, ob diese von Band 1 aussortiert werden.
    \item Es werden mehrere Werkstücke gleichzeitig auf Band 1 gelegt. Dabei wird überprüft, ob Band 1 stoppt und mit der Übergabe der Pucks wartet, bis Band 2 frei ist.
    \item Es werden Werkstücke in richtiger und falscher Reihenfolge auf Band 1 gelegt. Dabei wird überprüft, ob Band 2 ein betreffendes Puck zurück an den Anfang fährt und auf dessen Entnahme wartet, um die richtige Reihenfolge wiederherzustellen.
    \item Es werden Werkstücke mit der Bohrung nach unten auf Band 1 gelegt. Dabei wird überprüft, ob Band 1 stoppt, damit das Personal den Puck wenden kann, und bei Zurücklegen des Pucks weiterfährt, sofern Band 2 frei ist.
    \item Es werden Werkstücke mit der Bohrung nach unten auf Band 1 gelegt, die nicht vom Personal gewendet werden, um zu prüfen, ob diese Pucks von Band 2 aussortiert werden.
    \item Es werden Pucks im laufenden Betrieb an allen Segmenten entnommen oder hinzugefügt, um zu prüfen, ob die Zeitüberwachung dieser Segmente richtig arbeitet.
    \item Es werden zu flache Pucks auf Band 1 gelegt, bis die Rutsche voll ist, um zu prüfen, ob dessen Fehlerabarbeitung von Band 1 richtig arbeitet.
    \item Pucks mit der Bohrung nach unten werden am Ende von Band 2 nicht gewendet, bis die Rutsche von Band 2 voll ist, um zu prüfen, ob dessen Fehlerbearbeitung von Band 2 richtig arbeitet. 
\end{enumerate}

\newpage

% 8.3 Regressions-Test
\subsection{Regressions-Test}
Mögliche Regressionstests für die serielle Schnittstelle
\begin{enumerate}
 \item Korrektes Telegramm wird übertragen (Länge, Korrektheit)
 \item Fehlerhaftes Telegramm wird übertragen:
 \begin{enumerate}
  \item Ungültige Header-ID
  \item Ungültige Länge (EOF kommt zu früh oder zu spät)
  \item Fehlerhafter Header
  \item Fehlerhafter Inhalt
 \end{enumerate}
 Weitere Regressionstests:
 \item Synchronisierung
 \item Höhensensor emulieren
 \item Metallsensor emulieren
\end{enumerate}
Die Regressionstests wurden in den Unit-Tests umgesetzt.

% 8.4 Abnahme-Test
\subsection{Abnahme-Test}
Zum Abnahmetest werden alle Requirements und Use Cases durchgegangen. Anschließend werden
die Regressions-Tests und der Normalbetrieb der Anlage vorgeführt.

% 8.5 Testplan
\subsection{Testplan}
Da nach dem V-Modell vorgegangen wird, wird zu jedem Milestone die Funktionalität der für den Milestone benötigten Punkte getestet.

% 8.6 Testprotokolle und Auswertungen
\subsection{Testprotokolle und Auswertungen}
04.11.2014: Testen der HAL, insbesondere der Sensorik \newline
Nachdem die korrekte Ansteuerung der Aktorik und die serielle Schnittstelle mit dem zweiten Milestone abgenommen wurde, wurde die Sensorik getestet. Es wurde beobachtet, dass der Höhensensor (korrekte) Messwerte liefert. Weiterhin wurde beobachtet, dass das Programm sich aufhängt, sobald ein Messwert geliefert bzw. ein Interrupt von der Sensorik ausgelöst wurde. Dies benötigt weitere Bearbeitung.\\
\newline
06.11.2014: Der Interrupt für die Sensorik funktioniert.\\
\newline
\textcolor{red}{\textbf{
Das letzte Testprotokoll ist das Abnahmeprotokoll, das bei der abschließenden Vorführung erstellt
wird. Es enthält eine Auflistung der erfolgreich vorgeführten Funktionen des Systems sowie eine
Mängelliste mit Erklärungen der Ursachen der Fehlfunktionen und Vorschlägen zur Abhilfe}}

% 9. Lessons Learned
\section{Lessons Learned}
\textcolor{red}{\textbf{Was lief gut, was lief schlecht in diesem Projekt (technisch und organisatorisch)?\\
Was haben Sie gelernt?\\
Weitere Anregungen und Erkenntnisse durch das Projekt.}}

\newpage

% 10. Glossar
\section{Glossar}
Werkstück = Puck\newline 
Förderband, Band = Sortierband des Festo-Typs\newline
Weiche = Schranke, um Pucks auszusortieren oder durchzulassen\newline
Rutsche = Lagerplatz für aussortierte Werkstücke\newline
Bohrung = Aushöhlung der Werkstücke\newline
Ampel, Signal = Warnsignalanlage der Sortierbänder\newline
Stakeholder = Gruppen die mit der Anlage interagieren\newline
Steuerung = Software, um die Hardware zu koordinieren\newline
Personal = geschultes Personal, das die Sortieranlage bedient\newline
Interrupts = asynchrone Nachricht einer Systemkomponente\newline
Singleton – Modell zur Sicherstellung einer singulären Instanz\newline

% 11. Abkürzungen
\section{Abkürzungen}
WS = Werkstück\\

% 12. Anhänge
\section{Anhänge}

% 12.1 Coding Style: Google C++
\subsection{Coding Style: Google C++}

% 12.1.1 General Rules
\subsubsection{General Rules}
\begin{itemize}
 \item Use 2 spaces per indentation level.
 \item The maximum number of characters per line is 80.
 \item Never use tabs.
 \item Vertical whitespaces separate functions and are not used inside functions: use comments to document logical blocks.
 \item Header filenames end in \emph{.hpp}, implementation files end in \emph{cpp}.
 \item Never declare more than one variable per line.
 \item Ampersand {\&} binds to the \emph{type}, e.g., \emph{const std::string}\& \emph{arg}.
 \item Namespaces do not increase the indentation level.
 \item Access modifiers, e.g. \emph{public}, are indented one space.
 \item Use the order \emph{public}, \emph{protected}, and then \emph{private}.
 \item Use \emph{typename} only when referring to dependent names.
 \item Keywords are always followed by a whitespace: \emph{if (...), template \textless...\textgreater, while (...)}, etc.
 \item Always use \emph{\{\}} for bodies of control structures such as \emph{if} or \emph{while}, even for bodies consiting only of a single statement.
 \item Opening braces belong to the same line:
 \begin{lstlisting}
if (my_condition) {
  my_fun();
} else {
  my_other_fun();
}
 \end{lstlisting}
 \item Use standard order for readability: C standard libraries, C++ standard libraries, other libraries, your headers:
 \begin{lstlisting}
#include <sys/types.h>
#include <vector>
#include "some/other/library.hpp"
#include "myclass.hpp"
 \end{lstlisting}
 \item When declaring a function, the order of parameters is: outputs, then inputs. This follows the parameter order from the STL.
 \item Never use C-style casts.
\end{itemize}

\newpage

% 12.1.2 Naming
\subsubsection{Naming}
\begin{itemize}
 \item Class names, constants, and function names are all-lowercase with underscores.
 \item Types and variables should be nouns, while functions performing an action should be "{}command"{} verbs.
       Classes used to implement metaprogramming functions also should use verbs, e.g., \emph{remove\_const}.
 \item Member variables use the prefix \emph{m\_}.
 \item Thread-local variables use the prefix \emph{t\_}.
 \item Static, non-const variables are declared in the anonymous namespace and use the prefix \emph{s\_}.
 \item Template parameter names use CamelCase.
 \item Getter and setter use the name of the member without the \emph{m\_} prefix:
 \begin{lstlisting}
class some_fun {
 public:
  // ...
  int value() const {
    return m_value;
  }
  void value(int new_value) {
    m_value = new_value;
  }
 private:
  int m_value;
};
 \end{lstlisting}
\end{itemize}

% 12.1.3 Headers
\subsubsection{Headers}
\begin{itemize}
 \item Each \emph{.cpp} file has an associated \emph{.hpp} file. Exceptions to this rule are unit tests and \emph{main.cpp} files.
 \item All header files should use \emph{\#define} guards to prevent multiple inclusion.
 \item Do not \emph{\#include} when a forward declaration suffices.
 \item Use \emph{inline} for small functions (rule of thumb: 10 lines or less).
\end{itemize}

\newpage

% 12.1.4 Breaking statements
\subsubsection{Breaking Statements}
\begin{itemize}
 \item Break constructor initializers after the comma, use four spaces for indentation, and place each
 initializer on its own line (unless you don't need to break at all):
 \begin{lstlisting}
my_class::my_class()
    : my_base_class(some_function()),
      m_greeting("Hello there! This is my_class!" ),
      m_some_bool_flag(false) {
  // ok
 }
other_class::other_class() : m_name("tommy"), m_buddy("michael") {
  // ok
 }
 \end{lstlisting}
 \item Break function arguments after the comma for both declaration and invocation:
 \begin{lstlisting}
intptr_t channel::compare(const abstract_channel* lhs,
                          const abstract_channel* rhs) {
  // ...
}
 \end{lstlisting}
 \item Break before tenary operators and before binary operators:
 \begin{lstlisting}
if (today_is_a_sunny_day()
    && it_is_not_too_hot_to_go_swimming()) {
  // ...
}
 \end{lstlisting}
\end{itemize}

\end{document}
}